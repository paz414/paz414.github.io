<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parth Singh — Portfolio</title>
<meta name="color-scheme" content="light dark" />
<meta name="description" content="Parth Singh — Analytics Engineer, ML systems, IIT Delhi '26" />
<style>
  /* ==================== Tokens ==================== */
  :root{
    --bg:#0a0c10; --panel:#0e1117; --panel-2:#0b0e14;
    --text:#f5f7fb; --muted:#9aa3b2; --border:#1a2030;
    --accent:#7aa2ff; --accent-2:#9b8cff; --ring:rgba(122,162,255,.25);
  }
  html.light{
    --bg:#ffffff; --panel:#f9fafb; --panel-2:#f3f4f6;
    --text:#0a0c10; --muted:#6b7280; --border:#e5e7eb;
    --accent:#0f172a; --accent-2:#334155;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:var(--bg);color:var(--text);line-height:1.6;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit;text-decoration:none}
  .container{max-width:1160px;margin:0 auto;padding:0 20px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .muted{color:var(--muted)}
  .btn{
    --p:12px;display:inline-flex;align-items:center;gap:.55rem;border:1px solid var(--border);
    padding:calc(var(--p)-2px) calc(var(--p)+2px);border-radius:999px;font-weight:600;font-size:.95rem;
    background:transparent;cursor:pointer;transition:.2s transform, .25s box-shadow, .25s border-color;
  }
  .btn:hover{transform:translateY(-1px);border-color:color-mix(in srgb,var(--border) 65%,var(--accent))}
  .btn.primary{background:linear-gradient(180deg,#7aa2ff,#5a7bff);color:#fff;border-color:transparent;box-shadow:0 10px 35px rgba(122,162,255,.25)}
  .chip{padding:.38rem .7rem;border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:.8rem;display:inline-flex;align-items:center;gap:.4rem}
  .card{
    background:linear-gradient(180deg,color-mix(in srgb,var(--panel) 94%,transparent),color-mix(in srgb,var(--panel-2) 92%,transparent));
    border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 20px 60px rgba(20,24,38,.25);
    transition:.25s transform,.25s border-color,.25s box-shadow;will-change:transform,box-shadow;
  }
  .card:hover{transform:translateY(-3px);border-color:color-mix(in srgb,var(--border) 60%,var(--accent));box-shadow:0 28px 80px rgba(122,162,255,.18)}
  .tilt{transform-style:preserve-3d;perspective:1000px}
  .divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);border:0;margin:22px 0}
  section{scroll-margin-top:84px;padding:72px 0}
  h1{font-size:clamp(2rem,4vw,3.2rem);line-height:1.12;margin:0 0 .4rem;font-weight:800;letter-spacing:-.02em}
  h2{font-size:clamp(1.6rem,3vw,2.4rem);line-height:1.2;margin:0 0 .4rem;font-weight:750}
  h3{font-size:1.08rem;margin:.2rem 0 .2rem;font-weight:650}
  p{margin:.35rem 0;max-width:68ch}
  .grid{display:grid;gap:18px}
  .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:980px){ .grid.cols-2,.grid.cols-3{grid-template-columns:1fr} }
  .kicker{letter-spacing:.18em;text-transform:uppercase;font-size:.78rem;color:var(--muted);margin-bottom:8px}

  /* ==================== Header ==================== */
  .header{
    position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(10px);
    background:linear-gradient(180deg,rgba(8,10,16,.75),rgba(8,10,16,.45));border-bottom:1px solid var(--border);
  }
  .nav{display:flex;align-items:center;gap:22px;font-size:.95rem}
  .nav a{color:var(--muted)} .nav a:hover{color:var(--text)}
  .toggle{display:inline-flex;align-items:center;gap:.5rem;border:1px solid var(--border);padding:.45rem .85rem;border-radius:999px;background:transparent;color:var(--text);cursor:pointer}

  /* ==================== Tech Stage (kills blank space) ==================== */
  .stage{
    position:relative; height:48vh; min-height:360px; border-bottom:1px solid var(--border);
    background: radial-gradient(1200px 600px at 10% 0%, rgba(124,162,255,.15), transparent 70%),
                radial-gradient(900px 500px at 100% 20%, rgba(155,140,255,.12), transparent 60%),
                radial-gradient(1000px 500px at 40% 100%, rgba(80,200,255,.10), transparent 60%),
                linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
    overflow:hidden;
  }
  .stage canvas{position:absolute;inset:0}
  .stage .fg{
    position:absolute;inset:0;pointer-events:none;
    background:
      repeating-linear-gradient(90deg, rgba(255,255,255,.05) 0 1px, transparent 1px 80px),
      repeating-linear-gradient(0deg, rgba(255,255,255,.04) 0 1px, transparent 1px 80px);
    opacity:.08;
  }
  .stage .noise{
    position:absolute;inset:0;opacity:.05;mix-blend-mode:soft-light;pointer-events:none;
    background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAXUlEQVR4nO3QsQkAIBAEQY//aU2cQwqJ2g0c7m3g8v0Gf0mRDyqGxz8AAK6yF6bq2ZkAAIDB9P8k3WgAAKBP0wAAwE6bAABg0wYAAGDTBgAAYNMGAAAg3m0X3gQ7cQx6Xo2m8h/0o7o2CwAAAABJRU5ErkJggg==');
    background-size:256px 256px;
  }
  .stage .label{
    position:absolute;left:50%;bottom:24px;transform:translateX(-50%);text-align:center;
    padding:10px 14px;border:1px solid var(--border);border-radius:999px;background:rgba(10,12,16,.45);backdrop-filter:blur(8px);
    color:var(--muted);font-weight:600
  }

  /* ==================== Reveal ==================== */
  .reveal{opacity:0; transform:translateY(10px); transition:opacity .5s ease, transform .5s ease}
  .reveal.revealed{opacity:1; transform:none}

  footer{border-top:1px solid var(--border);padding:40px 0}
  @media (prefers-reduced-motion: reduce){
    .card:hover{transform:none}
    .reveal{transition:none}
  }
</style>
</head>
<body>
<header class="header">
  <div class="container" style="height:64px;display:flex;align-items:center;justify-content:space-between;">
    <a href="#top" style="font-weight:800;letter-spacing:.2px">Parth Singh</a>
    <nav class="nav">
      <a href="#experience">Experience</a>
      <a href="#projects">Projects</a>
      <a href="#skills">Skills</a>
      <a href="#achievements">Achievements</a>
      <a href="#education">Education</a>
      <a href="#extras">Beyond</a>
      <button id="theme" class="toggle" type="button" aria-label="Toggle theme">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M2 12h2m16 0h2M5.6 5.6l1.4 1.4m10 10 1.4 1.4M5.6 18.4l1.4-1.4m10-10 1.4-1.4"/></svg>
        <span id="themeLabel">Light</span>
      </button>
      <a class="btn" href="mailto:singh.parthiitd@gmail.com" style="padding:.45rem .9rem">Email</a>
    </nav>
  </div>
</header>

<!-- ==================== Tech Stage (animated NN/graph traversal) ==================== -->
<section id="top" class="stage">
  <canvas id="fx"></canvas>
  <div class="fg"></div>
  <div class="noise"></div>
  <div class="label">Neural traversal · interactive</div>
</section>

<main>
  <!-- HERO (tight, no big blank) -->
  <section class="container" style="padding-top:28px">
    <div class="row" style="justify-content:space-between;align-items:end;gap:18px">
      <div>
        <h1>Parth Singh</h1>
        <p class="muted">Analytics Engineer • IIT Delhi B.Tech '26</p>
        <p>Engineer focused on generative analytics, ML systems and reliable data tooling. I ship clean, production-grade features that actually move metrics.</p>
        <div class="row" style="margin-top:12px">
          <a class="btn primary" href="#projects">Explore work</a>
          <a class="btn" href="./resume.pdf" download>Download résumé</a>
          <button id="copyEmail" class="btn" type="button">Copy email</button>
        </div>
      </div>
      <div class="card tilt" style="min-width:260px">
        <div class="grid cols-2">
          <div class="chip">Real-time</div><div class="chip">Ops ready</div>
          <div class="chip">ML + Data</div><div class="chip">IITD ’26</div>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- EXPERIENCE -->
  <section id="experience">
    <div class="container reveal">
      <div style="margin-bottom:14px">
        <div class="kicker">Professional</div>
        <h2>Experience</h2>
      </div>
      <div class="grid">
        <article class="card tilt">
          <div class="row" style="justify-content:space-between;align-items:flex-start">
            <div>
              <h3>Analytics Engineer Intern · Chubb</h3>
              <small class="muted">Bengaluru, India · May 2025 – Jul 2025</small>
            </div>
            <span class="chip">PPO</span>
          </div>
          <ul style="margin-top:10px;padding-left:18px">
            <li>Production BI Agent with NL→SQL and auto Plotly dashboards on Snowflake.</li>
            <li>Auto SQL repair, relevance checks, input suggestions, and smart caching.</li>
            <li>Insurance complaints pipeline: 7.4K+ cases with L1→L2 root-cause tags.</li>
            <li>Token-aware batching on Azure OpenAI for schema-constrained prompts.</li>
            <li>IQR-based outlier detection and KPI trend visualizations.</li>
            <li>Received PPO for performance.</li>
          </ul>
        </article>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- PROJECTS -->
  <section id="projects">
    <div class="container reveal">
      <div style="margin-bottom:14px">
        <div class="kicker">Selected work</div>
        <h2>Projects</h2>
      </div>

      <div class="row" id="filters" style="margin-bottom:12px">
        <button class="btn chip" data-filter="All">All</button>
        <button class="btn chip" data-filter="ML">ML</button>
        <button class="btn chip" data-filter="Systems">Systems</button>
        <button class="btn chip" data-filter="Data">Data</button>
        <button class="btn chip" data-filter="Quant">Quant</button>
      </div>

      <div class="grid cols-3" id="projectGrid">
        <article class="card project tilt" data-cats="ML,Data">
          <div class="row" style="justify-content:space-between">
            <h3>Railway Incident Prediction (CRIS)</h3><span class="chip">ML</span>
          </div>
          <p class="muted">Jan 2025 – Present</p>
          <p>Predictive models for railway failures using heterogeneous signals with automated alignment of fault codes to operational and environmental signals.</p>
        </article>

        <article class="card project tilt" data-cats="ML,Quant">
          <div class="row" style="justify-content:space-between">
            <h3>Real-Time Market Data Forecasting (Jane Street)</h3><span class="chip">Quant</span>
          </div>
          <p class="muted">Dec 2024 – Present</p>
          <p>TimeXer with weighted R² 0.87; faster imputation and integrated exogenous/endogenous inputs.</p>
        </article>

        <article class="card project tilt" data-cats="Systems">
          <div class="row" style="justify-content:space-between">
            <h3>Parallel Graph Centrality (OpenMP)</h3><span class="chip">Systems</span>
          </div>
          <p class="muted">Sep 2024 – Dec 2024</p>
          <p>Degree and betweenness centrality with OpenMP; hybrid ranking for top-k influencers on graphs with 100k+ nodes and 13M edges.</p>
        </article>

        <article class="card project tilt" data-cats="Systems">
          <div class="row" style="justify-content:space-between">
            <h3>Virtual Machine Implementation (C++)</h3><span class="chip">Systems</span>
          </div>
          <p class="muted">Jun 2024 – Aug 2024</p>
          <p>Custom stack-based virtual CPU with assembler and lexer; file I/O, custom ISA, and debugging tools.</p>
        </article>

        <article class="card project tilt" data-cats="ML">
          <div class="row" style="justify-content:space-between">
            <h3>Resume Anomaly Detection</h3><span class="chip">ML</span>
          </div>
          <p class="muted">Oct 2024 – Present</p>
          <p>BiLSTM autoencoder with 92% precision; silhouette 0.87 and 91.7% accuracy for HR fraud detection at scale.</p>
        </article>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- SKILLS -->
  <section id="skills">
    <div class="container reveal">
      <div style="margin-bottom:14px">
        <div class="kicker">Tooling & stacks</div>
        <h2>Skills</h2>
      </div>
      <div class="grid cols-3">
        <div class="card tilt">
          <h3>Languages</h3>
          <div class="row" style="margin-top:8px">
            <span class="chip">Python</span><span class="chip">C++</span><span class="chip">Java</span>
          </div>
        </div>
        <div class="card tilt">
          <h3>Analytics</h3>
          <div class="row" style="margin-top:8px">
            <span class="chip">PyTorch</span><span class="chip">TensorFlow</span><span class="chip">scikit-learn</span>
            <span class="chip">Pandas</span><span class="chip">NumPy</span><span class="chip">Plotly</span>
          </div>
        </div>
        <div class="card tilt">
          <h3>Web</h3>
          <div class="row" style="margin-top:8px">
            <span class="chip">JavaScript</span><span class="chip">HTML/CSS</span><span class="chip">MySQL</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- ACHIEVEMENTS -->
  <section id="achievements">
    <div class="container reveal">
      <div style="margin-bottom:14px">
        <div class="kicker">Highlights</div>
        <h2>Achievements</h2>
      </div>
      <div class="grid cols-2">
        <div class="card tilt">Global Rank 9/500+ in Chubb hackathon (GPT-4 BI agent)</div>
        <div class="card tilt">Exchange Exam Rank 10/1200+ at IIT Delhi; KAIST offer</div>
        <div class="card tilt">Endowment Merit Scholarship (Top 5% dept.)</div>
        <div class="card tilt">Merit-based Branch Change (Top 7% first-year)</div>
        <div class="card tilt">INSPIRE Scholarship (Top 1% Class XII)</div>
        <div class="card tilt">JEE Advanced AIR 2291 (Top 0.9%)</div>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- EDUCATION -->
  <section id="education">
    <div class="container reveal">
      <div style="margin-bottom:14px">
        <div class="kicker">Academic</div>
        <h2>Education</h2>
      </div>
      <div class="card row tilt" style="justify-content:space-between">
        <div>
          <h3>Indian Institute of Technology, Delhi</h3>
          <small class="muted">B.Tech (2022–2026)</small>
        </div>
        <span class="chip">CGPA 7.817</span>
      </div>
    </div>
  </section>

  <hr class="divider" />

  <!-- EXTRAS -->
  <section id="extras">
    <div class="container reveal">
      <div style="margin-bottom:14px">
        <div class="kicker">Activities</div>
        <h2>Beyond work</h2>
      </div>
      <div class="grid cols-3">
        <div class="card tilt">Academic Mentor, ELL101 (2023)</div>
        <div class="card tilt">Captain, Lawn Tennis — Satpura Hostel (2024)</div>
        <div class="card tilt">WCA Rankings: #140 India, #3358 World (2024)</div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="container row" style="justify-content:space-between;">
    <small class="muted">© <span id="year"></span> Parth Singh. Built with clean edges.</small>
    <div class="row">
      <a href="mailto:singh.parthiitd@gmail.com" class="row">Email</a>
      <a href="tel:+916394711881" class="row">Call</a>
      <a href="https://github.com/paz414" target="_blank" rel="noreferrer" class="row">GitHub</a>
    </div>
  </div>
</footer>

<!-- ==================== JS: theme, palette, filters, tilt, reveal, stage ==================== -->
<script>
  // Year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Theme toggle with localStorage; defaults to dark
  const root = document.documentElement;
  const saved = localStorage.getItem('theme');
  if (saved === 'light') root.classList.add('light');
  const themeBtn = document.getElementById('theme');
  const themeLabel = document.getElementById('themeLabel');
  const setLabel = () => themeLabel.textContent = root.classList.contains('light') ? 'Dark' : 'Light';
  setLabel();
  themeBtn.addEventListener('click', () => {
    root.classList.toggle('light'); localStorage.setItem('theme', root.classList.contains('light') ? 'light':'dark'); setLabel();
  });

  // Smooth internal link scroll safety
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href^="#"]');
    if (!a) return;
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if (el) { e.preventDefault(); el.scrollIntoView({behavior:'smooth',block:'start'}); }
  });

  // Filters
  const grid = document.getElementById('projectGrid');
  const buttons = document.querySelectorAll('#filters .btn');
  if (buttons.length){
    buttons.forEach(btn => btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('primary'));
      btn.classList.add('primary');
      const want = btn.dataset.filter;
      grid.querySelectorAll('.project').forEach(card => {
        const cats = card.dataset.cats.split(',').map(s => s.trim());
        card.style.display = (want === 'All' || cats.includes(want)) ? '' : 'none';
      });
    }));
    document.querySelector('#filters [data-filter="All"]').classList.add('primary');
  }

  // Reveal on scroll
  const io = new IntersectionObserver((ents)=>ents.forEach(ent=> ent.isIntersecting && ent.target.classList.add('revealed')), {threshold:.12});
  document.querySelectorAll('section .container').forEach(el=>{ el.classList.add('reveal'); io.observe(el); });

  // Subtle tilt on hover
  const tilts = document.querySelectorAll('.tilt');
  const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
  tilts.forEach(el=>{
    let rAF = null;
    const onMove = (e) => {
      const rect = el.getBoundingClientRect();
      const x = e.clientX - rect.left, y = e.clientY - rect.top;
      const rx = clamp(((y/rect.height)-0.5)*6, -6, 6);
      const ry = clamp(((x/rect.width)-0.5)*-6, -6, 6);
      if (rAF) cancelAnimationFrame(rAF);
      rAF = requestAnimationFrame(()=>{ el.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateY(-3px)`; });
    };
    const reset = ()=>{ el.style.transform = ''; };
    el.addEventListener('pointermove', onMove);
    el.addEventListener('pointerleave', reset);
  });

  // Copy email nicety
  const copyBtn = document.getElementById('copyEmail');
  if (copyBtn) copyBtn.addEventListener('click', async () => {
    try{
      await navigator.clipboard.writeText('singh.parthiitd@gmail.com');
      const old = copyBtn.textContent; copyBtn.textContent = 'Copied ✓'; setTimeout(()=>copyBtn.textContent = old, 1200);
    }catch(e){}
  });

  /* ==================== Canvas Stage: Neural graph + BFS waves ==================== */
  (function(){
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = canvas.clientWidth = canvas.offsetWidth;
    let h = canvas.height = canvas.clientHeight = canvas.offsetHeight;

    const DPR = Math.min(window.devicePixelRatio || 1, 2);
    function resize(){
      const rect = canvas.getBoundingClientRect();
      w = canvas.width = Math.floor(rect.width * DPR);
      h = canvas.height = Math.floor(rect.height * DPR);
    }
    window.addEventListener('resize', resize); resize();

    // Graph
    const N = 120;             // nodes
    const K = 3;               // neighbors
    const nodes = [];
    const edges = [];          // [i,j]
    const edgeSet = new Set(); // "i-j" key to dedupe
    const radius = Math.min(w,h) * 0.34;

    const rand = (a,b)=>a + Math.random()*(b-a);

    // Create nodes roughly on a shell with jitter
    for (let i=0;i<N;i++){
      const ang = rand(0, Math.PI*2);
      const r = radius * rand(0.35, 1);
      const cx = w/2, cy = h/2;
      const x = cx + r * Math.cos(ang);
      const y = cy + r * Math.sin(ang) * rand(0.75,1);
      nodes.push({
        x,y,
        vx: rand(-0.25,0.25), vy: rand(-0.25,0.25),
        level: Infinity, // distance in BFS
        glow: 0
      });
    }
    // K nearest neighbors per node
    for (let i=0;i<N;i++){
      const dists = [];
      for (let j=0;j<N;j++){
        if (i===j) continue;
        const dx = nodes[i].x - nodes[j].x;
        const dy = nodes[i].y - nodes[j].y;
        dists.push([dx*dx+dy*dy, j]);
      }
      dists.sort((a,b)=>a[0]-b[0]);
      for (let k=0;k<K;k++){
        const j = dists[k][1];
        const a = Math.min(i,j), b = Math.max(i,j);
        const key = a+"-"+b;
        if (!edgeSet.has(key)){ edgeSet.add(key); edges.push([a,b]); }
      }
    }

    // BFS traversal levels from start node
    let start = Math.floor(Math.random()*N);
    function computeLevels(root){
      nodes.forEach(n=>n.level = Infinity);
      const q = [root]; nodes[root].level = 0;
      while(q.length){
        const u = q.shift();
        for (const [a,b] of edges){
          const v = (a===u)? b : (b===u)? a : -1;
          if (v>=0 && nodes[v].level===Infinity){
            nodes[v].level = nodes[u].level + 1; q.push(v);
          }
        }
      }
    }
    computeLevels(start);

    // Interaction
    const mouse = {x:w/2, y:h/2, active:false};
    window.addEventListener('pointermove', e=>{
      const rect = canvas.getBoundingClientRect();
      mouse.x = (e.clientX - rect.left) * DPR;
      mouse.y = (e.clientY - rect.top) * DPR;
      mouse.active = true;
    });
    window.addEventListener('pointerleave', ()=>mouse.active=false);
    window.addEventListener('click', ()=>{
      start = Math.floor(Math.random()*N);
      computeLevels(start);
      // little kick
      nodes.forEach(n=>{ n.vx += rand(-0.6,0.6); n.vy += rand(-0.6,0.6); });
    });

    // Drawing helpers
    function line(a,b,wid,alpha){
      ctx.globalAlpha = alpha;
      ctx.lineWidth = wid;
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.stroke();
      ctx.globalAlpha = 1;
    }
    function circle(p,r,alpha,fill=true){
      ctx.globalAlpha = alpha;
      ctx.beginPath();
      ctx.arc(p.x, p.y, r, 0, Math.PI*2);
      if (fill) ctx.fill(); else ctx.stroke();
      ctx.globalAlpha = 1;
    }

    let t = 0;
    function tick(){
      t += 1/60;

      // gentle parallax center
      const cx = w/2 + (mouse.active ? (mouse.x - w/2) * 0.02 : 0);
      const cy = h/2 + (mouse.active ? (mouse.y - h/2) * 0.02 : 0);

      // integrate nodes towards center shell
      for (const n of nodes){
        const dx = n.x - cx, dy = n.y - cy;
        const r = Math.max(1, Math.hypot(dx,dy));
        const targetR = radius * (0.75 + 0.15*Math.sin(0.6*t + r*0.0009));
        const k = 0.00035 * (targetR - r);
        n.vx += (dx/r) * k + 0.18 * Math.sin(t*0.6 + n.x*0.003) * 0.002;
        n.vy += (dy/r) * k + 0.18 * Math.cos(t*0.6 + n.y*0.003) * 0.002;

        // pointer repulsion
        if (mouse.active){
          const mx = n.x - mouse.x, my = n.y - mouse.y, mr = Math.hypot(mx,my);
          if (mr < 140*DPR){
            const f = (140*DPR - mr) / (140*DPR) * 0.15;
            n.vx += (mx/mr) * f; n.vy += (my/mr) * f;
          }
        }

        // integrate + damping
        n.x += n.vx; n.y += n.vy;
        n.vx *= 0.985; n.vy *= 0.985;
      }

      // Clear
      ctx.clearRect(0,0,w,h);

      // Styles
      ctx.strokeStyle = '#4b79ff';
      ctx.fillStyle   = '#92a9ff';

      // Current wave phase
      const speed = 0.8;                 // lower = slower wave
      const phase = t * speed;
      const maxLevel = Math.max(...nodes.map(n=>n.level));

      // Edges with traveling packets
      for (const [ai,bi] of edges){
        const a = nodes[ai], b = nodes[bi];

        // base line
        line(a,b,1.2*DPR,0.22);

        // pulse direction from lower-level to higher-level
        const la = a.level, lb = b.level;
        let src=a, dst=b, ls=la, ld=lb;
        if (lb < la){ src=b; dst=a; ls=lb; ld=la; }

        if (ls!==Infinity && ld!==Infinity){
          const local = phase - ls;                 // wave reached src
          if (local > 0){
            const span = Math.max(1, ld - ls);
            let p = Math.min(1, local / (span*0.9)); // progress along edge
            if (p>=0 && p<=1){
              const x = src.x + (dst.x - src.x) * p;
              const y = src.y + (dst.y - src.y) * p;
              ctx.fillStyle = 'rgba(146,169,255,0.9)';
              circle({x,y}, 2.2*DPR, 1, true);
              ctx.fillStyle = '#92a9ff';
            }
          }
        }
      }

      // Nodes
      for (const n of nodes){
        const l = n.level;
        let alpha = 0.55;
        if (l!==Infinity){
          const local = phase - l;
          if (local > 0 && local < 1.2){
            alpha = 0.55 + 0.35 * (1 - Math.abs(local-0.6)/0.6);
          }
        }
        circle(n, 2.4*DPR, alpha, true);
      }

      // Restart waves periodically
      if (phase > maxLevel + 3){
        start = Math.floor(Math.random()*N);
        computeLevels(start);
      }

      requestAnimationFrame(tick);
    }
    tick();
  })();
</script>
</body>
</html>
